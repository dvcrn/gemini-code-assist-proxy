
[tasks.build]
description = "Build the proxy"
run = "go build -o gemini-code-assist-proxy ./cmd/gemini-code-assist-proxy"

[tasks.run]
description = "Run the proxy"
run = "go run ./cmd/gemini-code-assist-proxy"

[tasks.test]
description = "Run all tests"
run = "go test -v ./..."

[tasks.release]
run = "mise run goreleaser_release"
description = "Alias for goreleaser_release"

[tasks.goreleaser_snapshot]
description = "Build CLI artifacts via GoReleaser (snapshot)"
run = "goreleaser release --snapshot --clean --config .goreleaser.yml"

[tasks.goreleaser_release]
description = "Publish GitHub Release via GoReleaser"
run = "goreleaser release --clean --config .goreleaser.yml"

[tasks.publish]
description = "Publish the npm wrapper package in npm/"
run = "cd npm/ && npm publish"

[tasks.format]
description = "Format Go code"
run = [
  "echo 'Formatting Go code...'",
  "go tool golang.org/x/tools/cmd/goimports -w .",
  "go tool mvdan.cc/gofumpt -w .",
  "echo 'All code formatted!'",
]

[tasks."build-worker"]
description = "Build for Cloudflare Workers"
run = [
  "go run github.com/syumai/workers/cmd/workers-assets-gen -mode=go",
  "GOOS=js GOARCH=wasm go build -o ./build/app.wasm cmd/gemini-code-assist-proxy-worker/main.go",
]

[tasks."wrangler-dev"]
description = "Run wrangler dev"
run = "bunx wrangler dev"

[tools]
go = "1.25.7"
node = "20"
goreleaser = "latest"
